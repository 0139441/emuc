<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Emulatrix | Leonardo Russo</title>
   		<link rel="stylesheet" href="Emulatrix.css">
	</head>
	<body>
		<script>
			var keys={9:"tab",13:"enter",16:"shift",18:"alt",27:"esc",33:"rePag",34:"avPag",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12"};
			window.addEventListener("keydown",function(e){if(keys[e.which]){e.preventDefault();}});

			function loadRomIntoVD()
				{
				var data = parent.ROMDATA;

				// STARTS THE VIRTUAL FILE SYSTEM				
				startFileSystem();

				// CREATES THE ROM FILE IN THE VIRTUAL DRIVE
				var dataView=new Uint8Array(data);
				FS.createDataFile("/","game.bin",dataView,true,false);

				// CREATES THE FOLDERS IN THE VIRTUAL DRIVE IN ORDER TO SAVE THE CONFIG FILE
				FS.createFolder("/home/web_user", "retroarch", true, true);
				FS.createFolder("/home/web_user/retroarch", "userdata", true, true);

				// CREATES THE VARIABLE FOR THE CONFIGURATION FILE
				var config = "";

				// SETS THE DEFAULT FOLDER WHEN BROWSING THE VIRTUAL DRIVE
				config += "rgui_browser_directory = /\n";

				// SETS THE KEY FOR THE START BUTTON
				config += "input_player1_start = enter\n";

				// SETS THE KEYS FOR THE BUTTONS A, B, C
				config += "input_player1_y = a\n";
				config += "input_player1_b = s\n";
				config += "input_player1_a = d\n";

				// SETS THE KEYS FOR THE BUTTONS X, Y, Z
				config += "input_player1_l = q\n";
				config += "input_player1_x = w\n";
				config += "input_player1_r = e\n";

				// SETS THE KEYS FOR UNWANTED FUNCTIONS
 				config += "slowmotion_ratio = 0.0\n";
				config += "input_enable_hotkey_btn = null\n";
				config += "input_game_focus_toggle = scroll_lock\n";

				var container_width = document.getElementById("container").offsetWidth;
				var container_height = document.getElementById("container").offsetHeight;

				// SETS THE VIDEO CONFIGURATION
				config += "video_vsync = true\n";
				config += "video_scale = 1\n";
				config += "video_window_x = " + container_width + "\n";
				config += "video_window_y = " + container_height + "\n";
				config += "aspect_ratio_index = 22\n";
				config += "custom_viewport_width = " + container_width + "\n";
				config += "custom_viewport_height = " + container_height + "\n";
				config += "custom_viewport_x = 0\n";
				config += "custom_viewport_y = 0\n";

				// SETS THE AUDIO LATENCY
				config += "audio_latency = 128\n";

				// HIDES THE NOTIFICATION MESSAGES
				config += "video_message_pos_x = -100\n";
				config += "video_message_pos_y = -100\n";

				// CREATES THE FILE WITH THE CONFIGURATION
				FS.createDataFile("/home/web_user/retroarch/userdata", "retroarch.cfg", config, true, true);

				// RUNS THE EMULATOR WITH THE SELECTED ROM
				Module.callMain(["-v","/game.bin"]);

				// RESIZES THE CANVAS
				document.getElementById("canvas").width = container_width;
				document.getElementById("canvas").height = container_height;
				}

			window.onload = function()
				{
				document.getElementById("container").style.display="block";
				setTimeout(function(){loadRomIntoVD();},1000);
				}
		</script>
		<div id="container"><canvas id="canvas" oncontextmenu="event.preventDefault()"></canvas></div>
		<script src="Emulatrix_SegaGenesis.js"></script>
	</body>
</html>